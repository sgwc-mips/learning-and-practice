# 指令系统

## 简介

从上到下，计算机系统可分为四个层次：

- 应用软件
- 基础软件
- 硬件逻辑
- 物理载体

软件以<u>指令形式</u>运行在CPU硬件上，指令系统介于软件和硬件之间。

指令系统包括：

- 指令集结构
- 运行时环境
- 存储管理机制
- 运行级别控制

## 设计原则

指令系统的设计应遵循如下原则：

- 兼容性。在较长时间内保持指令系统不变并保持向前兼容。
- 通用性。适用各种应用需求。
- 高效性。
- 安全性。

影响指令系统的因素：

- 工艺技术。
- 计算机体系结构。
- 操作系统。
- 编译技术。
- 应用程序

## 发展历程

### 指令集演变

- CISC（Complex Instruction Set Computer）
    - 指令长度可变
    - CPU在执行过程中将其翻译成一条或多条微代码
- RISC（Reduced Instruction Set Computer）
    - 指令长度相对固定
- VLIW（Very Long Instruction Word）
    - 本质上是多条同时执行的指令的组合

### 存储管理演变

- 连续实地址
- 段页存储
- 页式存储
- 段页式存储

### 运行级别演变

- 保护模式
    - 将程序分为两个权限等级：用户态、核心态。
    - 核心态具有最高权限，可执行所有指令，访问任意空间
    - 用户态程序只能访问受限内存空间，不允许访问外围设备。需要使用外围设备时，通过系统调用提出申请。
- 调试模式
    - 调试模式下，处理器仍在执行指令，调试指令可以从外部调试接口中获得，有专用协处理器寄存器使得被调试程序上下文无缝切换
- 虚拟化支持

## 指令集结构

### 地址空间

处理器可访问的地址空间：

- 寄存器空间
    - 包括：通用寄存器、特殊寄存器、控制寄存器
    - 通过指令及编码于指令中的寄存器号进行访问
- 系统内存空间
    - 通过访存指令访问

根据指令使用数据的方式，指令系统分为：

- 堆栈型。指令又称零地址指令，操作数都在栈顶，在运算指令中不需要指定操作数，默认对栈顶数据进行运算并将结果压回栈顶。
- 累加器型。指令又称单地址指令，包含一个隐含操作数——累加器，另一个操作数在指令中指定，结果写回到累加器中。
- 寄存器型。
    - 寄存器-存储器型。每个操作数都由显式指定，操作数为寄存器或内存地址。
    - 寄存器-寄存器型。每个操作数都由显式指定，除了访存指令外的其他指令的操作数都只能为寄存器。由于所有访存都必须显式通过load和store指令完成，所以寄存器-寄存器型又被称为load-store型。

### 操作数

数据类型

- 计算机中常见的数据类型包括整数、实数、字符。
- 指令中表达数据类型有两种方法。
    - 由指令操作码来区分不同类型。
    - 将不同类型的标记附在数据上。

访存地址

- 对齐访问：指对数据的访问起始地址和结束地址都符合其数据长度
- 尾端问题：大尾端、小尾端。

寻址方式

- 指如何在指令中表示要访问的数据在内存中的地址
- 偏移量寻址、立即数寻址、寄存器间接寻址是最常用的寻址方式

### 指令操作和编码

从功能上看，指令分为四大类：

- 运算指令
- 访存指令
- 转移指令
    - 包括：条件转移、无条件转移、过程调用、过程返回
    - 两个要素：转移条件、转移地址
    - 特点：条件转移在转移指令中最常用；条件转移通常只在转移指令附近进行跳转，偏移量一般不超过16位；转移条件比较简单，通常只是两个数的比较。
    - 实现方式：采用专用标志位（X86）、直接比较寄存器（MIPS）
- 特殊指令

指令编码

- 操作数和操作码在整个指令码中的摆放方式

