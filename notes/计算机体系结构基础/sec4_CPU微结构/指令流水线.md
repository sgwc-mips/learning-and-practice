# 指令流水线

##  单周期处理器

CPU数据通路要素

- 程序计数器（PC）
- 指令存储器
- 译码部件
- 通用寄存器堆
- 运算器
- 数据存储器

## 流水线处理器

增加触发器并采用分频时钟的处理器模型称为多周期处理器。可以将各个执行阶段以流水方式组织起来，同一时刻不同指令的不同执行阶段重叠在一起，进一步提高CPU执行效率

## 指令相关的流水线冲突

指令间的相关分为3类：

- 数据相关。两条指令访问同一个寄存器或内存单元，且这两条指令中至少有1条是写该寄存器或内存单元的指令。
- 控制相关。一条指令是转移指令且另一条指令是否被执行取决于该转移指令的结果。
- 结构相关。两条指令使用同一份硬件资源。

### 数据相关冲突解决方案

读写次序分为3类：

- RAW
- WAW
- WAR

可以采用阻塞解决。具体实现：将被阻塞流水级所在的寄存器保持原值不变，同时向被阻塞流水级的下一级流水级输入指令无效信号，用流水线空泡（Bubble）填充。

流水线前递技术：

- 在流水线的运算器通过多路选择器直接把前面指令的运算输出作为后面指令的输入。

### 控制相关冲突解决方案

控制相关引发冲突本质上是对PC的冲突访问引起的。

可以通过引入阻塞解决。

在单发射5级流水线中，如果增加专用的运算资源将转移指令条件判断和计算下一条指令PC的处理调整到译码阶段，那么转移指令后面的指令只需要在取指阶段等1拍。

为更近一步减少由控制相关引起的阻塞，可以采用转移指令的延迟槽技术，在定义指令系统的时候就明确转移指令延迟槽指令的执行不依赖于转移指令的结果，这样转移指令后面的指令在取指阶段1拍也不用等。

### 结构相关冲突解决方案

结构相关引起冲突的原因是两条指令要同时访问流水线中的同一个功能部件。

引入阻塞解决。

## 流水线与异常处理

## 提高流水线效率的技术

### 多发射数据通路

### 动态调整

### 转移预测

### 高速缓存

