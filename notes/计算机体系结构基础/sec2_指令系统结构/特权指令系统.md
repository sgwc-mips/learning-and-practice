# 特权指令系统

## 简介

​	现代计算机的指令系统在用户态子集之外还定义了特权态部分，称之为特权指令系统。

​	指令系统根据机制分类：

- 运行模式定义及其转换
    - 现代计算机操作系统都实现了保护模式，设计为用户态与核心态两种运行模式。
    - 应用运行在用户态模式下，操作系统运行在核心态模式下。
- 虚拟存储管理
    - 基本思想是让软件运行在“虚地址”上，与真正访问、存储的物理地址相隔离。
    - 虚实地址的转化，根据地址段属性的不同，分为 查表转化 和 直接映射。
- 异常与中断
    - 异常与中断是一种打断正常的软件执行流，切换到专门的处理函数的机制。
- 控制寄存器
    - 控制寄存器位于一个独立的地址空间，是支撑前面3种机制的具体实现。

## 异常与中断

### 异常分类

​	根据来源划分异常：

- 外部事件
    - 来自CPU核外部的事件，来自处理器内部其他模块或者处理器外部的真实物理连线。
    - 也称为 中断。
- 指令执行中的错误
    - 执行中的指令的操作码或操作数不符合要求
- 数据完整性问题
    - 当使用ECC等硬件校验方式的存储器发生校验错误时，会产生异常
- 地址转换异常
    - 在存储管理单元需要对一个内存页进行抵制转换，而硬件转换表没有有效的转换对应项可用时，会产生异常
- 系统调用和陷入
    - 由专有指令产生，目的是产生操作系用可识别异常，用于在保护模式下调用核心态相关操作
- 需要软件修正的运算
    - 某些操作和操作数的组合硬件由于实现的原因不愿意处理，寻求软件的帮助

### 异常处理

​	异常的处理流程

- 异常处理准备
- 确定异常来源
- 保存执行状态
- 处理异常
- 恢复执行状态并返回

### 中断

## 存储管理

### 存储管理原理

​	存储管理构建虚拟的内存地址，并通过MMU进行虚拟地址到物理地址的转换。

​	存储管理的作用和意义：

- 隐藏和保护
- 为程序分配连续的内存空间
- 扩展地址空间
- 节约物理内存

### TLB的结构和使用



### TLB异常处理

